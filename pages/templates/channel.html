<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="/connection.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="/css/components.css">
    <title>Discross - #{$CHANNEL_NAME}</title>
    <script>
        window.onload = function() {
          function scrollToBottom() {
            var end = document.getElementById("end");
            var msgContainer = document.getElementById("msgcontainer");
            var scrollableContent = document.querySelector(".scrollable-content");
            
            // Try multiple methods for maximum compatibility
            var scrolled = false;
            
            // Method 1: Scroll the .scrollable-content container (modern browsers)
            if (!scrolled && scrollableContent) {
              try {
                scrollableContent.scrollTop = scrollableContent.scrollHeight;
                scrolled = true;
              } catch (e) {
                // Continue to fallback
              }
            }
            
            // Method 2: scrollIntoView on #end element (works on most browsers)
            if (!scrolled && end && end.scrollIntoView) {
              try {
                end.scrollIntoView(false); // false = align to bottom
                scrolled = true;
              } catch (e) {
                // Continue to fallback
              }
            }
            
            // Method 3: Scroll window to bottom (Wii fallback)
            if (!scrolled) {
              try {
                window.scrollTo(0, document.body.scrollHeight);
                scrolled = true;
              } catch (e) {
                // Try one more method
              }
            }
            
            // Method 4: Old school body.scrollTop (really old browsers)
            if (!scrolled) {
              try {
                document.body.scrollTop = document.body.scrollHeight;
              } catch (e) {
                // Give up gracefully
              }
            }
          }
          
          // Scroll immediately on load
          scrollToBottom();
          
          // Also scroll after a short delay (in case images are loading)
          setTimeout(scrollToBottom, 100);
          setTimeout(scrollToBottom, 500);
        };

        // Emoji picker toggle
        var emojiShowing = false;
        function showEmoji() {
          var emojiPicker = document.getElementById("emoji");
          if (emojiPicker) {
            if (emojiShowing) {
              emojiPicker.style.display = "none";
              emojiShowing = false;
            } else {
              emojiPicker.style.display = "block";
              emojiShowing = true;
            }
          }
        }

    </script>
</head>

<body {$WHITE_THEME_ENABLED}>
    <div id="wrapper">
        <a href="../server/{$SERVER_ID}" class="menu-button">
            <img src="/resources/images/menu.gif" alt="Menu" class="menu-icon">
        </a>

        <div class="content-padding">
            <div class="scrollable-content">
                <div id="msgcontainer">
                    {$MESSAGES}
                </div>

                <div id="emoji" style="display: none;">
                    <div class="emoji-grid">
                        <button onclick="document.getElementById('message').value += ' :sob:'">
                            <img src="/resources/twemoji/1f62d.gif" alt="sob" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :face_with_raised_eyebrow:'">
                            <img src="/resources/twemoji/1f928.gif" alt="face_with_raised_eyebrow" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :skull:'">
                            <img src="/resources/twemoji/1f480.gif" alt="skull" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :pleading_face:'">
                            <img src="/resources/twemoji/1f97a.gif" alt="pleading_face" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :heart:'">
                            <img src="/resources/twemoji/2764-fe0f.gif" alt="heart" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :thumbsup:'">
                            <img src="/resources/twemoji/1f44d.gif" alt="thumbsup" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :thumbsdown:'">
                            <img src="/resources/twemoji/1f44e.gif" alt="thumbsdown" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :pray:'">
                            <img src="/resources/twemoji/1f64f.gif" alt="pray" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :tada:'">
                            <img src="/resources/twemoji/1f389.gif" alt="tada" class="emoji-icon">
                        </button>
                        <button onclick="document.getElementById('message').value += ' :slight_smile:'">
                            <img src="/resources/twemoji/1f642.gif" alt="slight_smile" class="emoji-icon">
                        </button>
                    </div>
                </div>

                <a id="end" name="end"></a>
            </div>
            <div class="message-form-container">
                <div class="modern-flex message-buttons-container">
                    <div class="message-button-cell">
                        <button class="icon-button" onclick="showEmoji()" type="button">
                            <img src="/resources/twemoji/{$RANDOM_EMOJI}.gif" alt="Add emoji" class="emoji-icon">
                        </button>
                    </div>
                    <div class="message-button-cell">
                        <a href="/draw/{$CHANNEL_ID}" class="icon-button">
                            <img src="/resources/twemoji/1f58c-fe0f.gif" alt="Draw" class="emoji-icon">
                        </a>
                    </div>
                    <div class="message-button-cell">
                        <a href="{$REFRESH_URL}" class="icon-button">
                            <img src="/resources/images/refresh.gif" alt="Refresh" class="emoji-icon">
                        </a>
                    </div>
                </div>

                <form action="../send" style="position: relative;">
                    <input type="hidden" id="channel" name="channel" value="{$CHANNEL_ID}">
                    <input type="hidden" id="lite" name="lite" value="False">

                    {$INPUT}
                </form>
            </div>
        </div>
    </div>
</body>

</html>